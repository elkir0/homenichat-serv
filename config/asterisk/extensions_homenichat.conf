; Homenichat Custom Dialplan
; Include this file in extensions.conf: #include extensions_homenichat.conf
;
; This dialplan provides:
; - Internal extension calling (1XXX)
; - Outbound calls via GSM modems (chan_quectel)
; - Test extensions (600-602)

[from-internal]
; Internal extension calls (1xxx)
exten => _1XXX,1,NoOp(Internal call to ${EXTEN})
 same => n,Dial(PJSIP/${EXTEN},30)
 same => n,Hangup()

; Outbound calls via GSM modem
; The modem name is dynamic - use MODEM_DEFAULT or first available
; French mobile numbers (06XX, 07XX)
exten => _06XXXXXXXX,1,NoOp(Outbound mobile to ${EXTEN})
 same => n,Set(MODEM=${IF($[${EXISTS(${MODEM_DEFAULT})}]?${MODEM_DEFAULT}:modem-1)})
 same => n,Dial(Quectel/${MODEM}/${EXTEN},120,g)
 same => n,Hangup()

exten => _07XXXXXXXX,1,NoOp(Outbound mobile to ${EXTEN})
 same => n,Set(MODEM=${IF($[${EXISTS(${MODEM_DEFAULT})}]?${MODEM_DEFAULT}:modem-1)})
 same => n,Dial(Quectel/${MODEM}/${EXTEN},120,g)
 same => n,Hangup()

; French landline (05XX)
exten => _05XXXXXXXX,1,NoOp(Outbound landline to ${EXTEN})
 same => n,Set(MODEM=${IF($[${EXISTS(${MODEM_DEFAULT})}]?${MODEM_DEFAULT}:modem-1)})
 same => n,Dial(Quectel/${MODEM}/${EXTEN},120,g)
 same => n,Hangup()

; International format +590 (Guadeloupe)
exten => _+590XXXXXXXXX,1,NoOp(Outbound intl to ${EXTEN})
 same => n,Set(MODEM=${IF($[${EXISTS(${MODEM_DEFAULT})}]?${MODEM_DEFAULT}:modem-1)})
 same => n,Dial(Quectel/${MODEM}/0${EXTEN:4},120,g)
 same => n,Hangup()

; Generic international +XX...
exten => _+X.,1,NoOp(Outbound international to ${EXTEN})
 same => n,Set(MODEM=${IF($[${EXISTS(${MODEM_DEFAULT})}]?${MODEM_DEFAULT}:modem-1)})
 same => n,Dial(Quectel/${MODEM}/${EXTEN},120,g)
 same => n,Hangup()

; ==================
; Test Extensions
; ==================

; Echo test (600) - hear your own voice
exten => 600,1,NoOp(Echo test)
 same => n,Answer()
 same => n,Playback(demo-echotest)
 same => n,Echo()
 same => n,Hangup()

; Talking clock (601)
exten => 601,1,NoOp(Talking clock)
 same => n,Answer()
 same => n,SayUnixTime()
 same => n,Hangup()

; Test tone (602)
exten => 602,1,NoOp(Test tone)
 same => n,Answer()
 same => n,MusicOnHold(default,30)
 same => n,Hangup()

; ==================
; Incoming calls from GSM
; ==================

[from-gsm]
exten => s,1,NoOp(Incoming GSM call from ${CALLERID(num)})
 same => n,Set(CALLERID(name)=GSM ${CALLERID(num)})
 same => n,Dial(PJSIP/1000,30)  ; Ring extension 1000
 same => n,VoiceMail(1000@default,u)
 same => n,Hangup()

; Invalid extension handler
exten => i,1,NoOp(Invalid extension ${EXTEN})
 same => n,Playback(invalid)
 same => n,Hangup()
